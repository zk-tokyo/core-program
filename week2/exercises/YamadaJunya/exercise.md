## 1. QAPのトレースがなぜ加算ゲートの出力を記録しなくてもいいのか、理由を説明してください。（ヒント: Linear PCP）

Linear PCPでは、加算ゲートの出力は既存ワイヤーの線形結合として表せるため、新しいワイヤーとして記録する必要がない。一方、乗算ゲートの出力は非線形であり、別途ワイヤーとして保持しなければ検証できないため。

---

## 2. 講義で紹介された算術回路とセレクター多項式をもとにマスター多項式p(x)と商多項式q(x)を一つ考えてください。

講義資料にあるセレクタ多項式($F_7, ω=2$)を用いて具体的な$p(x)$と$q(x)$を1組作成する。

### フィールドと評価点
- 体：$F_7$（係数は $\bmod 7$）
- 評価点：$\{1,2,4\}$（$\omega=2$ で $\omega^3\equiv1$）

$$
\{\omega,\ \omega^2,\ \omega^3\}=\{2,4,1\},\qquad \omega^3 \equiv 1 \pmod 7.
$$

### 回路の witness（例）
$$
w_1=3,\quad w_2=4,\quad w_3=2,\quad w_4=6,\quad w_5=1,\quad w_6=5 \pmod 7.
$$

#### 中間値
$$
g_1 = w_1 w_2 = 3\cdot 4 = 12 \equiv 5 \pmod 7
$$

$$
g_4 = g_1\cdot(w_3+w_4) = 5\cdot(2+6)=5\cdot 1 \equiv 5 \pmod 7
$$

$$
g_5 = (w_3+w_4)(w_5+w_6)=(2+6)(1+5)=1\cdot 6 \equiv 6 \pmod 7
$$

#### witness ベクトル
$$
\mathbf{c}=(w_1,w_2,w_3,w_4,w_5,w_6,g_1,g_4,g_5)=(3,4,2,6,1,5,5,5,6)
$$

---

### セレクター多項式（講義資料）

**左入力**
- $l_{w_1}=3x^2+6x+5$  
- $l_{w_3}=l_{w_4}=5x^2+5x+5$  
- $l_{g_1}=6x^2+3x+5$  

**右入力**
- $r_{w_2}=3x^2+6x+5$  
- $r_{w_3}=r_{w_4}=6x^2+3x+5$  
- $r_{w_5}=r_{w_6}=5x^2+5x+5$  

**出力**
- $o_{g_1}=3x^2+6x+5$  
- $o_{g_4}=6x^2+3x+5$  
- $o_{g_5}=5x^2+5x+5$  

---

### $L(x),R(x),O(x)$ の定義と途中式

#### $L(x)=\sum_i c_i\,l_i(x)$
$$
L(x)=w_1l_{w_1}+w_3l_{w_3}+w_4l_{w_4}+g_1l_{g_1}
$$

代入：
$$
L(x)=3(3x^2+6x+5)+2(5x^2+5x+5)+6(5x^2+5x+5)+5(6x^2+3x+5)
$$

各スカラー倍：
$$
3(3x^2+6x+5)\equiv 2x^2+4x+1
$$
$$
2(5x^2+5x+5)\equiv 3x^2+3x+3
$$
$$
6(5x^2+5x+5)\equiv 2x^2+2x+2
$$
$$
5(6x^2+3x+5)\equiv 2x^2+x+4
$$

和：
$$
L(x)\equiv 2x^2+3x+3 \pmod 7
$$

---

#### $R(x)=\sum_i c_i\,r_i(x)$
$$
R(x)=4(3x^2+6x+5)+2(6x^2+3x+5)+6(6x^2+3x+5)+1(5x^2+5x+5)+5(5x^2+5x+5)
$$

各スカラー倍：
$$
4(3x^2+6x+5)\equiv 5x^2+3x+6
$$
$$
2(6x^2+3x+5)\equiv 5x^2+6x+3
$$
$$
6(6x^2+3x+5)\equiv x^2+4x+2
$$
$$
1(5x^2+5x+5)\equiv 5x^2+5x+5
$$
$$
5(5x^2+5x+5)\equiv 4x^2+4x+4
$$

和：
$$
R(x)\equiv 6x^2+x+6 \pmod 7
$$

---

#### $O(x)=\sum_i c_i\,o_i(x)$
$$
O(x)=5(3x^2+6x+5)+5(6x^2+3x+5)+6(5x^2+5x+5)
$$

各スカラー倍：
$$
5(3x^2+6x+5)\equiv x^2+2x+4
$$
$$
5(6x^2+3x+5)\equiv 2x^2+x+4
$$
$$
6(5x^2+5x+5)\equiv 2x^2+2x+2
$$

和：
$$
O(x)\equiv 5x^2+5x+3 \pmod 7
$$

---

### マスター多項式 $p(x)$
$$
p(x)=L(x)R(x)-O(x)
$$

計算：
$$
p(x)=(2x^2+3x+3)(6x^2+x+6)-(5x^2+5x+3)\equiv 5x^4+6x^3+2x+1 \pmod 7
$$

---

### 消失多項式 $V(x)$ と商多項式 $q(x)$

消失多項式：
$$
V(x)=(x-1)(x-2)(x-4)\equiv x^3+6 \pmod 7
$$

商多項式：
$$
p(x)=V(x)q(x),\qquad q(x)=5x+6 \pmod 7
$$

---

### チェック
$$
p(2)\equiv 0,\quad p(4)\equiv 0,\quad p(1)\equiv 0 \pmod 7
$$

したがって
$$
p(x)=V(x)q(x)\ \text{が成り立つ}
$$


---

## 3. Linear PCPベースのSNARKとGroth16がどのような安全性仮定に基づいているか説明してください。(ヒント: Generic Group Model, KoE Assumption)

### Linear PCPベースのSNARK

Linear PCPベースのSNARKは、Generic Group Model（GGM）におけるセキュリティ証明に依拠している。これは、攻撃者が群構造以外の情報を利用できない理想化モデルであり、実際の代数的性質に依存しない強固な基盤を与える。加えて、Knowledge of Exponent（KoE）仮定が重要である。KoE仮定は、ある指数関係を構築できるアルゴリズムがその知識を内部的に保持していることを要求する強い仮定である。これにより、証明者が不正に知識を隠したまま有効な証明を生成することを防ぐ。

### Groth16

Groth16は、ペアリングベース暗号に基づく効率的なzk-SNARKであり、その安全性は主にKnowledge of Exponent（KoE）仮定に依存している。具体的には、証明者がペアリング群におけるある指数関係を構成できるならば、その指数自体を「知っている」とみなすことを保証する。この仮定により、証明者が偽の証明を生成することを防ぐ。また、Generic Group Modelの下での議論も補助的に用いられることがあるが、Groth16の中心はKoE仮定にある。
